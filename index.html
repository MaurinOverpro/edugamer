<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EduGamer OS v10.0 Phoenix</title>
    
    <!-- Librerie Esterne (Fondamentali) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* --- LAYOUT BASE (Fix Tablet P11/P12) --- */
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            font-family: 'Verdana', sans-serif; 
            margin: 0; 
            height: 100dvh; /* Usa altezza dinamica reale */
            width: 100vw;
            overflow: hidden; 
        }
        #root { height: 100%; width: 100%; }

        /* --- ANIMAZIONI --- */
        @keyframes shimmer { 
            0% { background-position: -200% 0; } 
            100% { background-position: 200% 0; } 
        }
        .xp-bar-fill { 
            background: linear-gradient(90deg, #16a34a, #4ade80, #16a34a); 
            background-size: 200% 100%; 
            animation: shimmer 2s infinite linear; 
        }
        @keyframes shake { 
            0% { transform: translateX(0); } 
            25% { transform: translateX(-5px); } 
            50% { transform: translateX(5px); } 
            75% { transform: translateX(-5px); } 
            100% { transform: translateX(0); } 
        }
        .shake { animation: shake 0.5s; border-color: #ef4444 !important; }

        /* --- UI COMPONENTS --- */
        .cyber-card {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
        }
        .cyber-card:hover { 
            border-color: #4ade80; 
            transform: translateY(-2px); 
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.2);
        }
        
        /* Lavagna Nodi */
        .cyber-box { 
            background: rgba(15, 23, 42, 0.95); 
            border: 2px solid #475569; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5); 
            transition: all 0.3s ease; 
        }
        .cyber-box.connected { border-color: #3b82f6; }

        /* Chat Bubbles */
        .msg-user { background: #166534; color: #dcfce7; border-radius: 12px 12px 0 12px; margin-left: auto; }
        .msg-ai { background: #581c87; color: #f3e8ff; border-radius: 12px 12px 12px 0; margin-right: auto; }

        /* --- SMART EDITOR (Highlighting) --- */
        .err-span { cursor: pointer; border-bottom: 2px solid; padding: 0 2px; position: relative; display: inline-block; transition: all 0.2s; }
        .err-span:hover { transform: scale(1.1); z-index: 10; background-color: rgba(255,255,255,0.1); }
        .err-ORT { border-color: #ef4444; color: #fca5a5; } /* Rosso */
        .err-PUN { border-color: #eab308; color: #fde047; } /* Giallo */
        .err-SIN { border-color: #3b82f6; color: #93c5fd; } /* Blu */
        
        .correction-popup {
            position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            background: #1e293b; border: 2px solid #cbd5e1; padding: 12px; border-radius: 12px;
            z-index: 50; width: 220px; box-shadow: 0 10px 25px rgba(0,0,0,0.8);
            margin-bottom: 8px; font-size: 14px; color: white; text-align: center;
        }
        .fix-input {
            background: #0f172a; border: 1px solid #475569; color: white; padding: 8px;
            border-radius: 4px; width: 100%; margin-top: 5px; text-align: center;
            font-weight: bold; outline: none; font-size: 16px;
        }
        .fix-input:focus { border-color: #4ade80; box-shadow: 0 0 10px rgba(74, 222, 128, 0.3); }

        /* --- MATEMATICA (Blocchi Base 10) --- */
        .holo-container {
            display: flex; flex-direction: row; flex-wrap: wrap; gap: 8px;
            align-items: flex-end; padding: 10px; background: rgba(0, 0, 0, 0.2);
            border-radius: 8px; border: 1px dashed #475569; min-height: 80px; width: 100%;
            overflow-y: auto;
        }
        .unit-block { width: 15px; height: 15px; background: #4ade80; border: 1px solid #166534; margin: 1px; }
        .ten-block { display: flex; flex-direction: column; margin: 2px; border: 1px solid #1e3a8a; }
        .ten-segment { width: 15px; height: 15px; background: #3b82f6; border-bottom: 1px solid #1e3a8a; }
        .hundred-block { display: grid; grid-template-columns: repeat(10, 1fr); width: 80px; margin: 4px; border: 2px solid #a855f7; }
        .hundred-segment { width: 8px; height: 8px; background: #a855f7; border: 0.5px solid #581c87; }

        /* --- TAVOLA PITAGORICA (Responsive) --- */
        .matrix-wrapper { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; padding: 10px; }
        .matrix-container {
            display: grid; grid-template-columns: repeat(11, 1fr); grid-template-rows: repeat(11, 1fr);
            gap: 2px; width: 80vmin; height: 80vmin; max-height: 100%; max-width: 100%;
        }
        .matrix-cell {
            width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;
            font-size: calc(80vmin / 25); border-radius: 3px; user-select: none;
        }
        .matrix-cell.header { background-color: #1e293b; color: #facc15; font-weight: bold; border: 1px solid #334155; }
        .matrix-cell.header.active { background-color: #eab308; color: #000; box-shadow: 0 0 10px #eab308; z-index: 20; transform: scale(1.1); }
        .matrix-cell.path { background-color: #1e293b; color: #4ade80; border: 1px solid #4ade80; opacity: 1 !important; }
        .matrix-cell.result { background-color: #4ade80; color: #020617; font-weight: bold; transform: scale(1.2); z-index: 30; box-shadow: 0 0 15px #4ade80; border: 2px solid #fff; opacity: 1 !important; }
        .matrix-cell.dimmed { opacity: 0.15; filter: grayscale(80%); }

        ::-webkit-scrollbar { width: 4px; } ::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const apiKey = ""; // Lasciare vuota, gestita da LocalStorage

        // --- ICONE SVG COMPLETA ---
        const Icons = {
            Brain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
            Home: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Upload: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Eye: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            Sound: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
            Stop: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="6" width="12" height="12" fill="currentColor"/></svg>,
            Chat: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Book: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Play: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Calc: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Lightbulb: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
            Mic: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M8 12h8"/><path d="M8 16h8"/><path d="M9 8h6"/></svg>, 
            Magic: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 7h6"/></svg>,
            Check: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        };

        // --- GESTIONE DATABASE ---
        const DB = {
            getKey: () => localStorage.getItem('gemini_api_key') || apiKey,
            getXP: () => parseInt(localStorage.getItem('edu_xp') || '0'),
            getLevel: () => Math.floor(Math.sqrt(parseInt(localStorage.getItem('edu_xp') || '0') / 10)) + 1,
            addXP: (amount) => {
                const next = parseInt(localStorage.getItem('edu_xp') || '0') + amount;
                localStorage.setItem('edu_xp', next.toString());
                window.dispatchEvent(new Event('xpChanged'));
                return next;
            },
            saveMap: (nodes, lines, summary) => {
                localStorage.setItem('saved_nodes', JSON.stringify(nodes));
                localStorage.setItem('saved_lines', JSON.stringify(lines));
                localStorage.setItem('saved_summary', summary);
            },
            loadMap: () => ({
                nodes: JSON.parse(localStorage.getItem('saved_nodes') || '[]'),
                lines: JSON.parse(localStorage.getItem('saved_lines') || '[]'),
                summary: localStorage.getItem('saved_summary') || ''
            }),
            clearMap: () => {
                localStorage.removeItem('saved_nodes');
                localStorage.removeItem('saved_lines');
                localStorage.removeItem('saved_summary');
            }
        };

        // --- SERVIZIO AI ---
        const GeminiService = {
            generate: async (p, c="") => {
                const k = DB.getKey(); if(!k) throw new Error("Manca API Key");
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${k}`, {
                    method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({contents:[{parts:[{text:c?`${p}\n\nTesto:${c}`:p}]}]})
                });
                if(!r.ok) throw new Error("Errore AI"); const d = await r.json(); return d.candidates?.[0]?.content?.parts?.[0]?.text || "Err";
            },
            chat: async (h, m) => {
                const k = DB.getKey(); if(!k) throw new Error("Manca API Key");
                const c = [...h.map(x=>({role:x.role==='user'?'user':'model',parts:[{text:x.text}]})),{role:'user',parts:[{text:m}]}];
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${k}`, {
                    method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({contents:c})
                });
                if(!r.ok) throw new Error("Errore AI"); const d = await r.json(); return d.candidates?.[0]?.content?.parts?.[0]?.text || "...";
            },
            analyzeToMap: async (b64) => {
                const k = DB.getKey(); if(!k) throw new Error("Manca API Key");
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${k}`, {
                    method: 'POST', headers: {'Content-Type':'application/json'}, 
                    body: JSON.stringify({contents:[{parts:[{text:"Analizza immagine scolastica. 1. OCR. 2. Riassunto. 3. 4-6 concetti CHIAVE (max 4 parole). 4. Spiegazione semplice. 5. Connessioni. Rispondi SOLO JSON: {\"ocr_text\":\"...\",\"summary\":\"...\",\"nodes\":[{\"id\":1,\"label\":\"...\",\"explanation\":\"...\"}],\"connections\":[{\"from\":1,\"to\":2}]}"},{inlineData:{mimeType:"image/jpeg",data:b64.split(',')[1]}}]}]})
                });
                if(!r.ok) throw new Error("Errore AI"); const d = await r.json();
                let t = d.candidates?.[0]?.content?.parts?.[0]?.text; return JSON.parse(t.replace(/```json/g,'').replace(/```/g,'').trim());
            },
            analyzeErrors: async (t) => {
                const k = DB.getKey(); if(!k) throw new Error("Manca API Key");
                const p = `Analizza testo bambino. Riscrivi UGUALE ma marca errori: [PAROLA|TIPO(ORT/PUN/SIN)|CORREZIONE|SPIEGAZIONE]. Testo: "${t}"`;
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${k}`, {
                    method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({contents:[{parts:[{text:p}]}]})
                });
                if(!r.ok) throw new Error("Errore AI"); const d = await r.json(); return d.candidates?.[0]?.content?.parts?.[0]?.text || t;
            },
            restructureText: async (t) => {
                const k = DB.getKey(); if(!k) throw new Error("Manca API Key");
                const p = `Sei ghostwriter per bambino. Riscrivi testo dettato in italiano corretto, con punteggiatura, semplice. Solo testo finale. Testo: "${t}"`;
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${k}`, {
                    method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({contents:[{parts:[{text:p}]}]})
                });
                if(!r.ok) throw new Error("Errore AI"); const d = await r.json(); return d.candidates?.[0]?.content?.parts?.[0]?.text || t;
            }
        };

        // --- APP COMPONENT ---
        const EduGamer = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [showSettings, setShowSettings] = useState(false);
            const [xp, setXP] = useState(DB.getXP());
            const [level, setLevel] = useState(DB.getLevel());

            useEffect(() => {
                const h = () => { setXP(DB.getXP()); setLevel(DB.getLevel()); };
                window.addEventListener('xpChanged', h);
                return () => window.removeEventListener('xpChanged', h);
            }, []);

            const Content = () => {
                if (showSettings) return <SettingsScreen onClose={()=>setShowSettings(false)} />;
                switch(activeTab) {
                    case 'board': return <CyberBoard />;
                    case 'tutor': return <CyberTutor />;
                    case 'reader': return <ReadingTool />;
                    case 'math': return <MathTool />;
                    default: return <HomeMenu setActiveTab={setActiveTab} />;
                }
            };

            return (
                <div className="h-full flex flex-col font-mono selection:bg-green-900 selection:text-white overflow-hidden">
                    <header className="h-16 px-4 border-b border-slate-700 flex justify-between items-center bg-slate-950 shrink-0 z-50">
                        <div className="flex items-center gap-4">
                            <div className="text-xl md:text-2xl font-bold tracking-tighter flex items-center gap-2 cursor-pointer text-green-400" onClick={() => setActiveTab('home')}>
                                <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div> EDUGAMER
                            </div>
                            <div className="hidden md:flex flex-col w-32 md:w-48">
                                <div className="flex justify-between text-xs text-yellow-400 font-bold mb-1"><span>LVL {level}</span><span>{xp} XP</span></div>
                                <div className="h-2 bg-slate-800 rounded-full overflow-hidden border border-slate-600"><div className="h-full xp-bar-fill" style={{width: `${Math.min(100, (xp % 100))}%`}}></div></div>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            {activeTab!=='home' && !showSettings && <button onClick={()=>setActiveTab('home')} className="px-3 py-2 rounded border border-slate-600 hover:bg-slate-800 text-sm flex items-center gap-2"><Icons.Home /> BASE</button>}
                            <button onClick={()=>setShowSettings(!showSettings)} className="p-2 rounded border border-slate-600 hover:bg-slate-800"><Icons.Settings /></button>
                        </div>
                    </header>
                    <main className="flex-1 overflow-hidden relative bg-slate-900"><Content /></main>
                </div>
            );
        };

        const SettingsScreen = ({ onClose }) => {
            const [key, setKey] = useState(localStorage.getItem('gemini_api_key') || '');
            const saveKey = () => { localStorage.setItem('gemini_api_key', key); alert("Chiave Salvata!"); onClose(); };
            return (
                <div className="h-full w-full flex flex-col items-center justify-center p-4 bg-slate-900/90 absolute inset-0 z-50">
                    <div className="bg-slate-800 p-8 rounded-2xl border border-slate-600 max-w-md w-full text-center shadow-2xl">
                        <h2 className="text-2xl font-bold mb-4 text-purple-400">CONFIGURAZIONE AI</h2>
                        <input type="password" value={key} onChange={(e) => setKey(e.target.value)} placeholder="API Key..." className="w-full bg-slate-900 border border-slate-600 p-3 rounded-xl mb-4 text-white"/>
                        <button onClick={saveKey} className="w-full p-3 rounded-xl bg-purple-600 font-bold text-white hover:bg-purple-500">SALVA</button>
                    </div>
                </div>
            );
        };

        const HomeMenu = ({ setActiveTab }) => {
            const cards = [
                { id: 'math', title: 'CYBER MATRIX', icon: Icons.Calc, desc: 'Calcoli & Memoria', color: 'border-yellow-500 text-yellow-400' },
                { id: 'board', title: 'LAVAGNA AI', icon: Icons.Brain, desc: 'Mappe Mentali', color: 'border-green-500 text-green-400' },
                { id: 'reader', title: 'SMART EDITOR', icon: Icons.Book, desc: 'Correttore & Ghostwriter', color: 'border-blue-500 text-blue-400' },
                { id: 'tutor', title: 'TUTOR', icon: Icons.Chat, desc: 'Chat Copilota', color: 'border-purple-500 text-purple-400' },
            ];
            return (
                <div className="h-full w-full overflow-y-auto p-4 flex flex-col items-center justify-center">
                    <h1 className="text-3xl md:text-5xl font-black text-center text-white mb-8">SELEZIONA MODULO</h1>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-4xl h-auto">
                        {cards.map(card => (
                            <button key={card.id} onClick={() => setActiveTab(card.id)} className={`cyber-card p-6 min-h-[140px] rounded-2xl flex flex-col items-center justify-center gap-2 text-center group ${card.color} border-2 bg-slate-800/50`}>
                                <div className="scale-125 opacity-80 group-hover:opacity-100 transition-opacity"><card.icon /></div>
                                <h2 className="text-xl font-bold">{card.title}</h2>
                                <p className="text-slate-400 text-sm">{card.desc}</p>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- READING TOOL (SMART EDITOR) ---
        const ReadingTool = () => {
            const [text, setText] = useState('');
            const [analyzedParts, setAnalyzedParts] = useState(null);
            const [loading, setLoading] = useState(false);
            const [activeError, setActiveError] = useState(null);
            const [userCorrection, setUserCorrection] = useState('');
            const [correctionStatus, setCorrectionStatus] = useState('');

            const handleRestructure = async () => {
                if(!text.trim()) return; setLoading(true);
                try { const res = await GeminiService.restructureText(text); setText(res); DB.addXP(10); } catch(e) { alert(e.message); }
                setLoading(false);
            };

            const handleAnalyze = async () => {
                if(!text.trim()) return; setLoading(true);
                try {
                    const raw = await GeminiService.analyzeErrors(text);
                    const regex = /\[(.*?)\|(.*?)\|(.*?)\|(.*?)\]/g;
                    let match; let lastIndex = 0; const parts = [];
                    while ((match = regex.exec(raw)) !== null) {
                        if (match.index > lastIndex) parts.push({ type: 'text', content: raw.substring(lastIndex, match.index) });
                        parts.push({ type: 'error', id: Math.random(), original: match[1], errType: match[2].trim().toUpperCase(), correction: match[3].trim(), explanation: match[4].trim() });
                        lastIndex = regex.lastIndex;
                    }
                    if (lastIndex < raw.length) parts.push({ type: 'text', content: raw.substring(lastIndex) });
                    setAnalyzedParts(parts); DB.addXP(20);
                } catch(e) { alert(e.message); }
                setLoading(false);
            };

            const verifyCorrection = (i) => {
                const target = analyzedParts[i];
                if (userCorrection.trim().toLowerCase() === target.correction.trim().toLowerCase()) {
                    const newParts = [...analyzedParts]; newParts[i] = { type: 'text', content: target.correction };
                    setAnalyzedParts(newParts); setActiveError(null); setUserCorrection(''); setCorrectionStatus('idle'); DB.addXP(50);
                } else { setCorrectionStatus('shake'); setTimeout(() => setCorrectionStatus('idle'), 500); }
            };

            const handleReset = () => {
                const full = analyzedParts.map(p => p.type === 'error' ? p.original : p.content).join('');
                setText(full); setAnalyzedParts(null); setActiveError(null);
            };

            const speakText = () => {
                window.speechSynthesis.cancel();
                const t = analyzedParts ? analyzedParts.map(p => p.type === 'error' ? p.original : p.content).join('') : text;
                if(!t) return; const u = new SpeechSynthesisUtterance(t); u.lang = 'it-IT'; window.speechSynthesis.speak(u);
            };

            return (
                <div className="h-full flex flex-col p-4 gap-4 max-w-3xl mx-auto w-full overflow-hidden relative">
                    <div className="flex gap-2 shrink-0 h-14">
                        {!analyzedParts ? (
                            <>
                                <button onClick={handleRestructure} disabled={loading} className="flex-1 bg-purple-600 hover:bg-purple-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 text-sm"><Icons.Magic /> {loading ? '...' : 'RISTRUTTURA'}</button>
                                <button onClick={handleAnalyze} disabled={loading} className="flex-1 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 text-sm"><Icons.Check /> {loading ? '...' : 'CONTROLLA'}</button>
                            </>
                        ) : (
                            <button onClick={handleReset} className="flex-1 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-bold flex items-center justify-center gap-2"><Icons.Brain /> MODIFICA / AGGIUNGI</button>
                        )}
                        <button onClick={speakText} className="w-16 bg-green-600 hover:bg-green-500 text-white rounded-xl flex items-center justify-center"><Icons.Play /></button>
                    </div>
                    <div className="flex-1 bg-slate-800 rounded-xl border-2 border-slate-600 p-6 text-lg leading-loose overflow-y-auto relative" onClick={() => setActiveError(null)}>
                        {!analyzedParts ? (
                            <textarea value={text} onChange={e => setText(e.target.value)} placeholder="Usa il microfono della tastiera per dettare..." className="w-full h-full bg-transparent resize-none outline-none text-slate-200 placeholder-slate-500" />
                        ) : (
                            <div className="text-slate-200">
                                {analyzedParts.map((p, i) => {
                                    if (p.type === 'text') return <span key={i}>{p.content}</span>;
                                    return (
                                        <span key={i} onClick={(e) => { e.stopPropagation(); setActiveError(i); setUserCorrection(''); }} className={`err-span err-${p.errType} rounded mx-1`}>
                                            {p.original}
                                            {activeError === i && (
                                                <div className="correction-popup" onClick={(e) => e.stopPropagation()}>
                                                    <div className="font-bold text-yellow-400 mb-1 text-xs">{p.errType === 'PUN' ? 'PUNTEGGIATURA' : 'ERRORE'}</div>
                                                    <div className="text-slate-300 text-xs mb-1">{p.explanation}</div>
                                                    <div className="text-[10px] text-slate-400 mb-2">Correggi:</div>
                                                    <input type="text" className={`fix-input ${correctionStatus === 'shake' ? 'shake' : ''}`} value={userCorrection} onChange={(e) => setUserCorrection(e.target.value)} autoFocus />
                                                    <button onClick={() => verifyCorrection(i)} className="bg-green-600 px-3 py-2 rounded text-xs font-bold w-full text-white mt-2 hover:bg-green-500">VERIFICA</button>
                                                </div>
                                            )}
                                        </span>
                                    );
                                })}
                            </div>
                        )}
                    </div>
                    {analyzedParts && <div className="flex gap-4 justify-center text-xs text-slate-400 shrink-0"><div className="flex items-center gap-1"><div className="w-3 h-3 bg-red-500/50 border border-red-500 rounded"></div> Ortografia</div><div className="flex items-center gap-1"><div className="w-3 h-3 bg-yellow-500/50 border border-yellow-500 rounded"></div> Punteggiatura</div><div className="flex items-center gap-1"><div className="w-3 h-3 bg-blue-500/50 border border-blue-500 rounded"></div> Sintassi</div></div>}
                </div>
            );
        };

        Il problema del "risultato 0" è quasi sicuramente dovuto a un blocco di sicurezza del browser (Content Security Policy) che impedisce l'uso di `eval()` o `new Function()`, oppure a un errore nel salvataggio dei punti (XP) che fa fallire tutto il blocco.

Per risolverlo definitivamente, ho riscritto il componente **`MathTool`** eliminando `eval` e inserendo un **motore di calcolo manuale e sicuro**. Inoltre, ho isolato l'assegnazione dei punti XP: se il database ha un problema, la calcolatrice deve funzionare lo stesso\!

Ecco il codice del componente **`MathTool`** corretto e blindato.

### Come installarlo (Metodo Chirurgico):

1.  Apri il tuo file `index.html`.
2.  Cerca la riga `const MathTool = () => {`.
3.  Seleziona **tutta la funzione** fino alla parentesi graffa di chiusura `};` prima di `const CyberBoard`.
4.  Sostituiscila con questo blocco:

<!-- end list -->

```javascript
// --- MATH TOOL (VERSIONE OLOGRAFICA - SENZA TASTO UGUALE) ---
        const MathTool = () => {
            const [mode, setMode] = useState('calc');
            const [display, setDisplay] = useState(''); // Parte vuoto
            const [highlight, setHighlight] = useState({ r: null, c: null });
            const [visualize, setVisualize] = useState(true); // Sempre attivo di default

            // Gestione Tasti: Niente =, aggiorna solo il display
            const handleBtn = (val) => {
                if (val === 'C') {
                    setDisplay('');
                } else {
                    setDisplay(prev => prev + val);
                }
            };

            // Renderer dei Blocchi (Base 10)
            const Base10Renderer = ({ num, colorLabel }) => {
                if (!num || isNaN(num)) return null;
                const n = Math.floor(Number(num));
                if (n > 1000) return <div className="text-red-400 p-2 text-xs">Numero troppo grande per i blocchi!</div>;
                
                const hundreds = Math.floor(n / 100);
                const remainder100 = n % 100;
                const tens = Math.floor(remainder100 / 10);
                const units = remainder100 % 10;

                return (
                    <div className="flex flex-col items-start gap-2 p-2 rounded bg-slate-800/50 border border-slate-700 w-full mb-2">
                        <div className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">{colorLabel} ({n})</div>
                        <div className="holo-container">
                            {/* Centinaia (Viola) */}
                            {[...Array(hundreds)].map((_, i) => (
                                <div key={`h-${i}`} className="hundred-block">
                                    {[...Array(100)].map((_, j) => <div key={j} className="hundred-segment"></div>)}
                                </div>
                            ))}
                            {/* Decine (Blu) */}
                            {[...Array(tens)].map((_, i) => (
                                <div key={`t-${i}`} className="ten-block">
                                    {[...Array(10)].map((_, j) => <div key={j} className="ten-segment"></div>)}
                                </div>
                            ))}
                            {/* Unità (Verdi) */}
                            <div className="flex flex-wrap gap-1" style={{minWidth: '20px'}}>
                                {[...Array(units)].map((_, i) => <div key={`u-${i}`} className="unit-block"></div>)}
                            </div>
                        </div>
                    </div>
                );
            };

            // Logica Olografica in Tempo Reale
            const renderVisuals = () => {
                if (!display) return <div className="flex flex-col items-center justify-center h-full opacity-30 text-center"><Icons.Brain size={48} /><p className="mt-2 text-sm">Componi un numero...</p></div>;

                // Cerca operazione: Numero Operatore Numero
                const match = display.match(/(\d+(\.\d+)?)([\+\-\*\/])(\d+(\.\d+)?)/);

                if (match) {
                    const [_, n1Str, __, op, n2Str] = match;
                    const n1 = parseFloat(n1Str);
                    const n2 = parseFloat(n2Str);

                    // 1. Divisione (Visualizzazione a Gruppi)
                    if (op === '/') {
                        if (n2 === 0) return <div className="text-red-400">Impossibile dividere per zero!</div>;
                        const quotient = Math.floor(n1 / n2);
                        const remainder = n1 % n2;
                        const exact = Math.round((n1 / n2) * 10) / 10; // Max 1 decimale

                        return (
                            <div className="flex flex-col w-full animate-in fade-in pb-20">
                                <div className="text-green-400 font-bold text-sm sticky top-0 bg-slate-900 py-1 z-10">SITUAZIONE INIZIALE:</div>
                                <Base10Renderer num={n1} colorLabel="TUTTO IL GRUPPO" />
                                
                                <div className="text-xl font-bold text-center text-yellow-400 my-2">⬇️ DIVISO IN GRUPPI DA {n2} ⬇️</div>
                                
                                <div className="text-green-400 font-bold text-sm sticky top-0 bg-slate-900 py-1 z-10">RISULTATO:</div>
                                <div className="flex flex-wrap gap-4 justify-center">
                                    {/* Gruppi Interi */}
                                    {[...Array(quotient)].map((_, g) => (
                                        <div key={g} className="flex flex-col items-center gap-1">
                                            <div className="text-[10px] text-slate-500">Gruppo {g+1}</div>
                                            <div className="bg-slate-800 p-2 rounded border border-blue-500/50 flex flex-wrap gap-1 justify-center" style={{minWidth:'40px'}}>
                                                {[...Array(n2)].map((_, i) => <div key={i} className="unit-block bg-blue-500"></div>)}
                                            </div>
                                        </div>
                                    ))}
                                    {/* Resto */}
                                    {remainder > 0 && (
                                        <div className="flex flex-col items-center gap-1">
                                            <div className="text-[10px] text-yellow-500 font-bold animate-pulse">RESTO</div>
                                            <div className="bg-slate-800 p-2 rounded border border-yellow-500 flex flex-wrap gap-1 justify-center" style={{minWidth:'40px'}}>
                                                {[...Array(Math.floor(remainder))].map((_, i) => <div key={i} className="unit-block bg-yellow-500"></div>)}
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <div className="mt-4 text-center bg-slate-800 p-3 rounded-xl border border-slate-600">
                                    <div className="text-2xl text-white font-bold">{quotient} <span className="text-sm font-normal text-slate-400">col resto di</span> <span className="text-yellow-400">{Math.floor(remainder)}</span></div>
                                    <div className="text-xs text-slate-500 mt-1">Calcolo esatto: {exact}</div>
                                </div>
                            </div>
                        );
                    }

                    // 2. Altre Operazioni (Timeline Verticale)
                    let res = 0;
                    if(op === '+') res = n1 + n2;
                    if(op === '-') res = n1 - n2;
                    if(op === '*') res = n1 * n2;

                    return (
                        <div className="flex flex-col w-full animate-in fade-in pb-10">
                            <div className="text-green-400 font-bold text-sm sticky top-0 bg-slate-900 py-1 z-10">STORIA DEL CALCOLO:</div>
                            <Base10Renderer num={n1} colorLabel="1. INIZIO" />
                            <div className="text-3xl font-bold text-center text-yellow-400 my-1">{op}</div>
                            <Base10Renderer num={n2} colorLabel="2. AZIONE" />
                            <div className="text-3xl font-bold text-center text-white my-1">=</div>
                            <Base10Renderer num={res} colorLabel="3. RISULTATO FINALE" />
                            <div className="text-center text-3xl font-bold text-green-400 mt-2">{res}</div>
                        </div>
                    );
                }

                // Solo numero (mentre digita il primo)
                return (
                    <div className="flex flex-col w-full animate-in fade-in">
                        <div className="text-green-400 font-bold text-sm mb-2">NUMERO ATTUALE:</div>
                        <Base10Renderer num={display} colorLabel="QUANTITÀ" />
                    </div>
                );
            };

            return (
                <div className="h-full flex flex-col gap-4 p-4 overflow-hidden">
                    {/* Tab Switcher */}
                    <div className="flex gap-2 shrink-0 h-12">
                        <button onClick={()=>setMode('calc')} className={`rounded-xl border-2 flex-1 font-bold transition-all ${mode==='calc'?'bg-slate-800 border-yellow-400 text-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.3)]':'border-slate-700 opacity-50'}`}>CALCOLATRICE</button>
                        <button onClick={()=>setMode('matrix')} className={`rounded-xl border-2 flex-1 font-bold transition-all ${mode==='matrix'?'bg-slate-800 border-yellow-400 text-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.3)]':'border-slate-700 opacity-50'}`}>TAVOLA</button>
                    </div>
                    
                    <div className="flex-1 bg-slate-950 rounded-xl border-2 border-slate-700 overflow-hidden relative flex">
                        {mode === 'calc' ? (
                            <div className="flex w-full h-full">
                                {/* SINISTRA: TASTIERINO */}
                                <div className="w-1/3 md:w-1/4 p-4 border-r border-slate-700 flex flex-col gap-2 bg-slate-900/50">
                                    <div className="bg-slate-900 p-4 rounded-xl mb-2 text-right text-3xl font-mono border border-slate-600 text-yellow-400 h-20 flex items-center justify-end overflow-hidden">
                                        {display || <span className="animate-pulse opacity-50">_</span>}
                                    </div>
                                    
                                    <div className="grid grid-cols-4 gap-2 flex-1">
                                        {['7','8','9','/','4','5','6','*','1','2','3','-','0','.','+'].map(b => (
                                            <button key={b} onClick={()=>handleBtn(b)} className={`text-2xl font-bold rounded-lg shadow-lg active:scale-95 transition-all ${['/','*','-','+'].includes(b)?'bg-slate-700 text-yellow-400 border border-slate-600':'bg-slate-800 text-white border border-slate-700 hover:bg-slate-700'} ${b==='0'?'col-span-2':''}`}>
                                                {b === '*' ? '×' : b === '/' ? '÷' : b}
                                            </button>
                                        ))}
                                        {/* Tasto C rosso grande al posto dell'uguale */}
                                        <button onClick={()=>handleBtn('C')} className="bg-red-600 hover:bg-red-500 text-white text-2xl font-bold rounded-lg shadow-lg active:scale-95 transition-all border border-red-400">C</button>
                                    </div>
                                </div>

                                {/* DESTRA: OLOGRAFIA */}
                                <div className="flex-1 p-4 overflow-y-auto bg-slate-900 scrollbar-thin">
                                    {renderVisuals()}
                                </div>
                            </div>
                        ) : (
                            /* TAVOLA PITAGORICA (Richiama componente esterno) */
                            <Matrix highlight={highlight} setHighlight={setHighlight} />
                        )}
                    </div>
                </div>
            );
        };
```

        // --- CYBER BOARD (LAVAGNA) ---
        const CyberBoard = () => {
            const [stage, setStage] = useState('upload');
            const [bgImage, setBgImage] = useState(null);
            const [data, setData] = useState(null);
            const [nodes, setNodes] = useState([]);
            const [lines, setLines] = useState([]);
            const [activeNode, setActiveNode] = useState(null);
            const [tempLine, setTempLine] = useState(null);

            useEffect(() => {
                const saved = DB.loadMap();
                if(saved.nodes.length > 0) { setNodes(saved.nodes); setLines(saved.lines); setData({ summary: saved.summary }); setStage('playing'); }
            }, []);

            const handleImageUpload = async (e) => {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = async (evt) => {
                    setBgImage(evt.target.result); setStage('scanning');
                    try {
                        const aiData = await GeminiService.analyzeToMap(evt.target.result);
                        setData(aiData);
                        const cx = window.innerWidth/2; const cy = window.innerHeight/2; const r = Math.min(cx,cy)/1.5;
                        const newNodes = aiData.nodes.map((n,i)=>({ ...n, x: cx + r*Math.cos((i/aiData.nodes.length)*2*Math.PI)-75, y: cy + r*Math.sin((i/aiData.nodes.length)*2*Math.PI)-40, w:150, h:80 }));
                        setNodes(newNodes); setLines([]); DB.saveMap(newNodes, [], aiData.summary); setStage('playing');
                    } catch(e) { alert("Errore AI: " + e.message); setStage('upload'); }
                };
                reader.readAsDataURL(file);
            };

            const handleTouchMove = (e) => { if(activeNode) { const t=e.touches[0]; setTempLine({x1:activeNode.sx, y1:activeNode.sy, x2:t.clientX, y2:t.clientY}); } };
            
            const handleTouchEnd = (e) => {
                if(activeNode) {
                    const t=e.changedTouches[0]; const el=document.elementFromPoint(t.clientX, t.clientY); const target=el?.closest('.cyber-box');
                    if(target) {
                        const tid=parseInt(target.dataset.id);
                        if(tid && tid!==activeNode.id) {
                            const n1=nodes.find(n=>n.id===activeNode.id); const n2=nodes.find(n=>n.id===tid);
                            setLines([...lines, {x1:n1.x+75, y1:n1.y+40, x2:n2.x+75, y2:n2.y+40, from:n1.id, to:n2.id}]);
                            DB.addXP(20); DB.saveMap(nodes, [...lines, {from:n1.id, to:n2.id}], data.summary);
                        }
                    }
                    setActiveNode(null); setTempLine(null);
                }
            };

            if(stage==='upload') return ( 
                <div className="h-full flex flex-col items-center justify-center p-6 text-center overflow-y-auto">
                    <div className="border-2 border-dashed border-slate-600 rounded-3xl p-10 flex flex-col items-center gap-4 bg-slate-800/30">
                        <Icons.Upload />
                        <h2 className="text-2xl font-bold text-slate-200">CARICA ESERCIZIO</h2>
                        <label className="bg-green-600 text-white font-bold py-3 px-8 rounded-full cursor-pointer shadow-lg">
                            <input type="file" onChange={handleImageUpload} className="hidden" accept="image/*"/>SCATTA FOTO
                        </label>
                        {nodes.length > 0 && <button onClick={()=>setStage('playing')} className="mt-4 text-sm text-slate-400 underline">Torna alla mappa salvata</button>}
                    </div>
                </div> 
            );
            
            if(stage==='scanning') return (
                <div className="h-full flex items-center justify-center">
                    <h2 className="text-green-400 animate-pulse font-bold text-2xl">ANALISI AI...</h2>
                </div>
            );

            return (
                <div className="h-full relative bg-slate-950 overflow-hidden" onTouchMove={handleTouchMove} onTouchEnd={handleTouchEnd}>
                    {bgImage && <div className="absolute inset-0 opacity-10 pointer-events-none" style={{backgroundImage:`url(${bgImage})`, backgroundSize:'cover'}}></div>}
                    <svg className="absolute inset-0 w-full h-full pointer-events-none z-0">
                        {lines.map((l,i)=><line key={i} x1={l.x1} y1={l.y1} x2={l.x2} y2={l.y2} stroke="#4ade80" strokeWidth="4"/>)}
                        {tempLine && <line x1={tempLine.x1} y1={tempLine.y1} x2={tempLine.x2} y2={tempLine.y2} stroke="#fff" strokeWidth="2" strokeDasharray="5,5"/>}
                    </svg>
                    {nodes.map(n=>( 
                        <div key={n.id} data-id={n.id} className="absolute flex items-center justify-center p-2 text-xs font-bold text-white rounded-lg cyber-box z-10" 
                             style={{left:n.x, top:n.y, width:n.w, height:n.h}} 
                             onTouchStart={(e)=>{ const t=e.touches[0]; setActiveNode({id:n.id, sx:n.x+75, sy:n.y+40}); }} 
                             onClick={()=>{ window.speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(n.explanation); u.lang='it-IT'; window.speechSynthesis.speak(u); }}>
                            {n.label}
                        </div> 
                    ))}
                     <div className="absolute bottom-4 left-4 right-4 bg-slate-800/90 border border-slate-600 rounded-xl p-4 max-h-32 overflow-y-auto z-20">
                        <div className="flex justify-between items-center mb-1">
                            <span className="text-green-400 font-bold text-xs">RIASSUNTO</span>
                            <button onClick={()=>{setStage('upload'); DB.clearMap(); setNodes([]); setLines([]);}} className="text-xs text-red-400 border border-red-900 px-2 py-1 rounded">RESET</button>
                        </div>
                        <p className="text-slate-300 text-xs">{data?.summary}</p>
                    </div>
                </div>
            );
        };

        // --- CYBER TUTOR ---
        const CyberTutor = () => {
            const [msgs, setMsgs] = useState([{role:'model', text:'Ciao! Sono il Copilota. Cosa studiamo?'}]);
            const [inpt, setInpt] = useState('');
            const [load, setLoad] = useState(false);
            const endRef = useRef(null);
            
            useEffect(()=>endRef.current?.scrollIntoView({behavior:'smooth'}),[msgs]);
            
            const send = async () => { 
                if(!inpt.trim() || load) return; 
                const h = [...msgs, {role:'user', text:inpt}]; 
                setMsgs(h); setInpt(''); setLoad(true); 
                try { const r = await GeminiService.chat(h, inpt); setMsgs([...h, {role:'model', text:r}]); DB.addXP(5); } catch { setMsgs([...h, {role:'model', text:'Errore AI.'}]); } 
                setLoad(false); 
            };
            
            return ( 
                <div className="h-full flex flex-col bg-slate-900">
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {msgs.map((m,i)=><div key={i} className={`p-3 max-w-[85%] text-sm rounded-xl ${m.role==='user'?'msg-user':'msg-ai'}`}><b>{m.role==='user'?'TU':'AI'}:</b> {m.text}</div>)}
                        <div ref={endRef}></div>
                    </div>
                    <div className="p-3 bg-slate-800 flex gap-2 shrink-0">
                        <input type="text" value={inpt} onChange={e=>setInpt(e.target.value)} className="flex-1 bg-slate-900 border border-slate-600 rounded-xl p-3 text-white" placeholder="Scrivi..."/><button onClick={send} disabled={load} className="bg-purple-600 text-white p-3 rounded-xl font-bold">INVIA</button>
                    </div>
                </div> 
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EduGamer />);
    </script>
</body>
</html>