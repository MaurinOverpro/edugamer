<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EduGamer OS v14 - Lavagna AI Potenziata</title>
    
    <!-- Librerie Esterne -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas per export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* --- LAYOUT BASE --- */
        * { box-sizing: border-box; }
        body { 
            background-color: #0a0e17; 
            color: #e2e8f0; 
            font-family: 'Verdana', sans-serif; 
            margin: 0; 
            height: 100dvh;
            width: 100vw;
            overflow: hidden; 
        }
        #root { height: 100%; width: 100%; }

        /* --- FONT LEGGIBILE PER DSA --- */
        .dsa-text {
            font-family: 'Verdana', 'Arial', sans-serif;
            letter-spacing: 0.5px;
            line-height: 1.6;
        }

        /* --- ANIMAZIONI --- */
        @keyframes shimmer { 
            0% { background-position: -200% 0; } 
            100% { background-position: 200% 0; } 
        }
        .xp-bar-fill { 
            background: linear-gradient(90deg, #16a34a, #4ade80, #16a34a); 
            background-size: 200% 100%; 
            animation: shimmer 2s infinite linear; 
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(74, 222, 128, 0.3); }
            50% { box-shadow: 0 0 20px rgba(74, 222, 128, 0.6); }
        }
        .pulse-glow { animation: pulse-glow 2s infinite; }

        @keyframes bounce-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .bounce-subtle { animation: bounce-subtle 2s infinite ease-in-out; }

        @keyframes selected-pulse {
            0%, 100% { box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(251, 191, 36, 0.2); }
        }
        .node-selected { animation: selected-pulse 1s infinite; }

        /* --- UI COMPONENTS --- */
        .cyber-card {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
        }
        .cyber-card:hover { 
            border-color: #4ade80; 
            transform: translateY(-2px); 
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.2);
        }

        /* --- NODI MAPPA MENTALE --- */
        .node-central {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            border: 3px solid #60a5fa;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }
        
        .node-movement {
            background: linear-gradient(135deg, #0d9488 0%, #14b8a6 100%);
            border: 2px solid #5eead4;
        }
        
        .node-body {
            background: linear-gradient(135deg, #c2410c 0%, #f97316 100%);
            border: 2px solid #fdba74;
        }
        
        .node-effect {
            background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
            border: 2px solid #c4b5fd;
        }
        
        .node-concept {
            background: linear-gradient(135deg, #be185d 0%, #ec4899 100%);
            border: 2px solid #f9a8d4;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #4ade80; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #22c55e; }

        /* Print styles */
        @media print {
            body { background: white !important; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useCallback } = React;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CONFIGURAZIONE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const GEMINI_MODEL = "gemini-2.0-flash";

        // Categorie per i nodi con emoji e colori
        const NODE_CATEGORIES = {
            central: { emoji: 'üìö', color: 'node-central', label: 'Tema' },
            movement: { emoji: 'üîÑ', color: 'node-movement', label: 'Movimento' },
            body: { emoji: 'üåç', color: 'node-body', label: 'Corpo celeste' },
            effect: { emoji: '‚ú®', color: 'node-effect', label: 'Effetto' },
            concept: { emoji: 'üí°', color: 'node-concept', label: 'Concetto' }
        };

        // Mappa parole chiave -> categoria
        const categorizeNode = (label) => {
            const l = label.toLowerCase();
            if (l.includes('rotazione') || l.includes('rivoluzione') || l.includes('moto') || l.includes('movimento')) return 'movement';
            if (l.includes('terra') || l.includes('luna') || l.includes('sole') || l.includes('pianeta') || l.includes('satellite')) return 'body';
            if (l.includes('stagion') || l.includes('marea') || l.includes('giorno') || l.includes('notte') || l.includes('effett')) return 'effect';
            return 'concept';
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ICONE SVG
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const Icons = {
            Brain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
            Home: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Upload: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Volume: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
            Link: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            Eye: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            Share: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>,
            Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Trash: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DATABASE (LocalStorage)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const DB = {
            getKey: () => localStorage.getItem('gemini_api_key') || '',
            setKey: (key) => localStorage.setItem('gemini_api_key', key),
            getXP: () => parseInt(localStorage.getItem('edu_xp') || '0'),
            getLevel: () => Math.floor(Math.sqrt(parseInt(localStorage.getItem('edu_xp') || '0') / 10)) + 1,
            addXP: (amount) => {
                const next = parseInt(localStorage.getItem('edu_xp') || '0') + amount;
                localStorage.setItem('edu_xp', next.toString());
                window.dispatchEvent(new Event('xpChanged'));
                return next;
            },
            saveMap: (data) => {
                localStorage.setItem('cyberboard_data', JSON.stringify(data));
            },
            loadMap: () => {
                try {
                    return JSON.parse(localStorage.getItem('cyberboard_data') || 'null');
                } catch (e) {
                    return null;
                }
            },
            clearMap: () => {
                localStorage.removeItem('cyberboard_data');
            }
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SERVIZIO AI (Gemini)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const getApiUrl = (key) => `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${key}`;

        const GeminiService = {
            analyzeToMap: async (imagesInput) => {
                const key = DB.getKey();
                if (!key) throw new Error("Inserisci prima la API Key!");
                
                const imagesArray = Array.isArray(imagesInput) ? imagesInput : [imagesInput];

                const prompt = `Analizza queste immagini di un libro scolastico per creare una MAPPA MENTALE per un bambino di 9 anni con DSA (dislessia).

OBIETTIVI:
1. Identifica il TEMA PRINCIPALE (sar√† il nodo centrale)
2. Estrai 4-6 CONCETTI CHIAVE collegati al tema
3. Per ogni concetto scrivi una spiegazione SEMPLICISSIMA (max 15 parole, linguaggio da bambino)
4. Crea un RIASSUNTO a PUNTI (5-7 punti, ogni punto max 10 parole)

CATEGORIE per i concetti:
- "movement" = movimenti (rotazione, rivoluzione, moto)
- "body" = corpi celesti (Terra, Luna, Sole, pianeti)
- "effect" = effetti/conseguenze (stagioni, maree, giorno/notte)
- "concept" = altri concetti importanti

Rispondi SOLO con questo JSON esatto:
{
    "title": "Titolo del tema principale",
    "summary_points": [
        "üåç Punto 1 breve",
        "üîÑ Punto 2 breve",
        "‚òÄÔ∏è Punto 3 breve"
    ],
    "nodes": [
        {
            "id": 1,
            "label": "Nome Concetto",
            "category": "movement|body|effect|concept",
            "explanation": "Spiegazione semplicissima per bambino"
        }
    ],
    "connections": [
        {"from": 0, "to": 1}
    ]
}

IMPORTANTE:
- Il nodo con id=0 √® sempre il TEMA CENTRALE
- Le connections collegano i nodi tramite i loro id
- Le spiegazioni devono essere MOLTO semplici, come parleresti a un bambino
- Usa emoji appropriate nei summary_points`;

                const imageParts = imagesArray.map(img => ({
                    inlineData: { 
                        mimeType: "image/jpeg", 
                        data: img.includes(',') ? img.split(',')[1] : img 
                    }
                }));

                const response = await fetch(getApiUrl(key), {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                ...imageParts
                            ]
                        }],
                        generationConfig: { temperature: 0.3 }
                    })
                });
                
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error("Errore Google: " + (err.error?.message || "Sconosciuto"));
                }

                const data = await response.json();
                let text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                text = text.replace(/```json/g, '').replace(/```/g, '').trim();
                
                // Trova il JSON
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
                throw new Error("Risposta AI non valida");
            }
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // COMPONENTE: LAVAGNA AI POTENZIATA
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const CyberBoard = () => {
            const [stage, setStage] = useState('upload');
            const [images, setImages] = useState([]);
            const [mapData, setMapData] = useState(null);
            const [nodes, setNodes] = useState([]);
            const [lines, setLines] = useState([]);
            const [mode, setMode] = useState('study'); // 'study' | 'connect'
            const [selectedNode, setSelectedNode] = useState(null);
            const [expandedNode, setExpandedNode] = useState(null);
            const [userLines, setUserLines] = useState([]); // Linee create dall'utente
            const mapRef = useRef(null);

            // Carica salvataggio
            useEffect(() => {
                const saved = DB.loadMap();
                if (saved && saved.nodes && saved.nodes.length > 0) {
                    setMapData(saved.mapData);
                    setNodes(saved.nodes);
                    setLines(saved.lines || []);
                    setUserLines(saved.userLines || []);
                    setStage('playing');
                }
            }, []);

            // Salva quando cambia qualcosa
            useEffect(() => {
                if (nodes.length > 0) {
                    DB.saveMap({ mapData, nodes, lines, userLines });
                }
            }, [nodes, lines, userLines, mapData]);

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    setImages(prev => [...prev, evt.target.result]);
                };
                reader.readAsDataURL(file);
            };

            const startAnalysis = async () => {
                if (images.length === 0) return;
                setStage('scanning');

                try {
                    const aiData = await GeminiService.analyzeToMap(images);
                    setMapData(aiData);

                    // Calcola posizioni - nodo centrale + satellite
                    const cx = window.innerWidth / 2;
                    const cy = (window.innerHeight - 200) / 2; // Spazio per pannello sotto
                    const radius = Math.min(cx, cy) * 0.6;

                    // Nodo centrale (id=0)
                    const centralNode = {
                        id: 0,
                        label: aiData.title || "Tema",
                        category: 'central',
                        explanation: "Questo √® il tema principale della lezione",
                        x: cx - 90,
                        y: cy - 50,
                        w: 180,
                        h: 100,
                        isCentral: true
                    };

                    // Nodi satellite
                    const satelliteNodes = (aiData.nodes || []).map((n, i) => {
                        const angle = (i / aiData.nodes.length) * 2 * Math.PI - Math.PI / 2;
                        const cat = n.category || categorizeNode(n.label);
                        return {
                            ...n,
                            id: n.id || i + 1,
                            category: cat,
                            x: cx + radius * Math.cos(angle) - 70,
                            y: cy + radius * Math.sin(angle) - 40,
                            w: 140,
                            h: 80,
                            isCentral: false
                        };
                    });

                    const allNodes = [centralNode, ...satelliteNodes];
                    setNodes(allNodes);

                    // Crea linee dalle connessioni AI
                    const aiLines = (aiData.connections || []).map(conn => {
                        const fromNode = allNodes.find(n => n.id === conn.from);
                        const toNode = allNodes.find(n => n.id === conn.to);
                        if (fromNode && toNode) {
                            return {
                                id: `ai-${conn.from}-${conn.to}`,
                                from: conn.from,
                                to: conn.to,
                                isUserCreated: false
                            };
                        }
                        return null;
                    }).filter(Boolean);

                    // Se non ci sono connessioni, collega tutto al centrale
                    if (aiLines.length === 0) {
                        satelliteNodes.forEach(n => {
                            aiLines.push({
                                id: `ai-0-${n.id}`,
                                from: 0,
                                to: n.id,
                                isUserCreated: false
                            });
                        });
                    }

                    setLines(aiLines);
                    setUserLines([]);
                    DB.addXP(30);
                    setStage('playing');
                } catch (e) {
                    alert("Errore AI: " + e.message);
                    setStage('upload');
                }
            };

            const handleNodeClick = (node) => {
                if (mode === 'study') {
                    // Mostra/nascondi spiegazione
                    setExpandedNode(expandedNode === node.id ? null : node.id);
                    
                    // Leggi ad alta voce
                    window.speechSynthesis.cancel();
                    const text = node.explanation || node.label;
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'it-IT';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                } else if (mode === 'connect') {
                    // Modalit√† collegamento
                    if (selectedNode === null) {
                        setSelectedNode(node.id);
                    } else if (selectedNode !== node.id) {
                        // Crea nuovo collegamento
                        const newLine = {
                            id: `user-${selectedNode}-${node.id}`,
                            from: selectedNode,
                            to: node.id,
                            isUserCreated: true
                        };
                        
                        // Verifica che non esista gi√†
                        const exists = [...lines, ...userLines].some(l => 
                            (l.from === selectedNode && l.to === node.id) ||
                            (l.from === node.id && l.to === selectedNode)
                        );
                        
                        if (!exists) {
                            setUserLines(prev => [...prev, newLine]);
                            DB.addXP(10);
                            
                            // Feedback
                            const utterance = new SpeechSynthesisUtterance("Collegamento creato!");
                            utterance.lang = 'it-IT';
                            window.speechSynthesis.speak(utterance);
                        }
                        setSelectedNode(null);
                    } else {
                        setSelectedNode(null);
                    }
                }
            };

            const deleteUserLine = (lineId) => {
                setUserLines(prev => prev.filter(l => l.id !== lineId));
            };

            const getLineCoords = (line) => {
                const fromNode = nodes.find(n => n.id === line.from);
                const toNode = nodes.find(n => n.id === line.to);
                if (!fromNode || !toNode) return null;
                return {
                    x1: fromNode.x + fromNode.w / 2,
                    y1: fromNode.y + fromNode.h / 2,
                    x2: toNode.x + toNode.w / 2,
                    y2: toNode.y + toNode.h / 2
                };
            };

            const speakAll = () => {
                window.speechSynthesis.cancel();
                
                // Costruisci testo da leggere
                let text = `Il tema √®: ${mapData?.title || 'la lezione'}. `;
                
                if (mapData?.summary_points) {
                    text += "I punti principali sono: ";
                    mapData.summary_points.forEach((p, i) => {
                        text += `${i + 1}: ${p.replace(/[^\w\s√†√®√©√¨√≤√π√ß]/gi, '')}. `;
                    });
                }
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'it-IT';
                utterance.rate = 0.85;
                window.speechSynthesis.speak(utterance);
            };

            const exportImage = async () => {
                if (!mapRef.current) return;
                
                try {
                    const canvas = await html2canvas(mapRef.current, {
                        backgroundColor: '#0a0e17',
                        scale: 2
                    });
                    
                    const link = document.createElement('a');
                    link.download = `mappa-${mapData?.title || 'mentale'}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    DB.addXP(5);
                } catch (e) {
                    alert("Errore export: " + e.message);
                }
            };

            const shareMap = async () => {
                if (!mapRef.current) return;
                
                try {
                    const canvas = await html2canvas(mapRef.current, {
                        backgroundColor: '#0a0e17',
                        scale: 2
                    });
                    
                    canvas.toBlob(async (blob) => {
                        if (navigator.share && navigator.canShare) {
                            const file = new File([blob], `mappa-${mapData?.title || 'mentale'}.png`, { type: 'image/png' });
                            
                            if (navigator.canShare({ files: [file] })) {
                                await navigator.share({
                                    title: `Mappa: ${mapData?.title || 'Mentale'}`,
                                    text: 'Guarda la mappa mentale che ho creato!',
                                    files: [file]
                                });
                                return;
                            }
                        }
                        
                        // Fallback: download
                        const link = document.createElement('a');
                        link.download = `mappa-${mapData?.title || 'mentale'}.png`;
                        link.href = URL.createObjectURL(blob);
                        link.click();
                    }, 'image/png');
                    
                } catch (e) {
                    console.error("Errore condivisione:", e);
                }
            };

            const handleReset = () => {
                if (confirm("Vuoi cancellare la mappa e ricominciare?")) {
                    setStage('upload');
                    DB.clearMap();
                    setNodes([]);
                    setLines([]);
                    setUserLines([]);
                    setMapData(null);
                    setImages([]);
                    setSelectedNode(null);
                    setExpandedNode(null);
                }
            };

            // ‚îÄ‚îÄ‚îÄ FASE UPLOAD ‚îÄ‚îÄ‚îÄ
            if (stage === 'upload') {
                return (
                    <div className="h-full flex flex-col items-center justify-center p-6 text-center overflow-y-auto">
                        <div className="border-2 border-dashed border-slate-600 rounded-3xl p-8 flex flex-col items-center gap-6 bg-slate-800/30 max-w-2xl w-full">
                            
                            <div>
                                <div className="text-5xl mb-4">üìö</div>
                                <h2 className="text-2xl font-bold text-slate-200 dsa-text">CARICA LE FOTO DEL LIBRO</h2>
                                <p className="text-slate-400 text-sm mt-2 dsa-text">
                                    Fotografa le pagine da studiare
                                </p>
                            </div>

                            {images.length > 0 && (
                                <div className="flex gap-3 overflow-x-auto w-full p-3 bg-slate-900/50 rounded-xl border border-slate-700 min-h-[110px] items-center">
                                    {images.map((img, idx) => (
                                        <div key={idx} className="relative shrink-0">
                                            <img src={img} className="h-24 w-auto rounded-lg border-2 border-slate-500" />
                                            <div className="absolute -top-2 -right-2 bg-green-500 text-black text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center">
                                                {idx + 1}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="flex gap-4 flex-wrap justify-center">
                                <label className="bg-slate-700 hover:bg-slate-600 text-white font-bold py-4 px-8 rounded-xl cursor-pointer shadow-lg transition-all border border-slate-500 flex items-center gap-3 text-lg">
                                    <input type="file" onChange={handleImageUpload} className="hidden" accept="image/*" capture="environment" />
                                    <Icons.Upload className="w-6 h-6" />
                                    üì∑ SCATTA FOTO
                                </label>

                                {images.length > 0 && (
                                    <button 
                                        onClick={startAnalysis}
                                        className="bg-green-600 hover:bg-green-500 text-white font-bold py-4 px-8 rounded-xl shadow-[0_0_20px_rgba(74,222,128,0.5)] transition-all flex items-center gap-3 text-lg bounce-subtle"
                                    >
                                        <Icons.Brain className="w-6 h-6" />
                                        üöÄ CREA MAPPA
                                    </button>
                                )}
                            </div>
                            
                            {images.length > 0 && (
                                <button onClick={() => setImages([])} className="text-sm text-red-400 underline hover:text-red-300">
                                    üóëÔ∏è Cancella foto
                                </button>
                            )}
                        </div>
                    </div>
                );
            }

            // ‚îÄ‚îÄ‚îÄ FASE ANALISI ‚îÄ‚îÄ‚îÄ
            if (stage === 'scanning') {
                return (
                    <div className="h-full flex flex-col items-center justify-center gap-6">
                        <div className="w-20 h-20 border-4 border-green-500 border-t-transparent rounded-full animate-spin"></div>
                        <h2 className="text-green-400 font-bold text-2xl dsa-text">ü§ñ STO LEGGENDO...</h2>
                        <p className="text-slate-400 dsa-text">Analizzo {images.length} {images.length === 1 ? 'pagina' : 'pagine'}</p>
                    </div>
                );
            }

            // ‚îÄ‚îÄ‚îÄ FASE MAPPA ‚îÄ‚îÄ‚îÄ
            return (
                <div className="h-full flex flex-col overflow-hidden">
                    {/* Toolbar */}
                    <div className="flex gap-2 p-3 bg-slate-900 border-b border-slate-700 shrink-0 flex-wrap no-print">
                        {/* Mode Toggle */}
                        <div className="flex rounded-xl overflow-hidden border border-slate-600">
                            <button
                                onClick={() => { setMode('study'); setSelectedNode(null); }}
                                className={`px-4 py-2 font-bold flex items-center gap-2 transition-all ${
                                    mode === 'study' 
                                        ? 'bg-blue-600 text-white' 
                                        : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                                }`}
                            >
                                <Icons.Eye className="w-4 h-4" /> STUDIA
                            </button>
                            <button
                                onClick={() => { setMode('connect'); setExpandedNode(null); }}
                                className={`px-4 py-2 font-bold flex items-center gap-2 transition-all ${
                                    mode === 'connect' 
                                        ? 'bg-yellow-600 text-white' 
                                        : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                                }`}
                            >
                                <Icons.Link className="w-4 h-4" /> COLLEGA
                            </button>
                        </div>

                        <div className="flex-1"></div>

                        {/* Actions */}
                        <button onClick={speakAll} className="p-2 rounded-lg bg-green-600 hover:bg-green-500 text-white" title="Ascolta tutto">
                            <Icons.Volume className="w-5 h-5" />
                        </button>
                        <button onClick={exportImage} className="p-2 rounded-lg bg-purple-600 hover:bg-purple-500 text-white" title="Salva immagine">
                            <Icons.Download className="w-5 h-5" />
                        </button>
                        <button onClick={shareMap} className="p-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white" title="Condividi">
                            <Icons.Share className="w-5 h-5" />
                        </button>
                        <button onClick={handleReset} className="p-2 rounded-lg bg-red-600 hover:bg-red-500 text-white" title="Ricomincia">
                            <Icons.Trash className="w-5 h-5" />
                        </button>
                    </div>

                    {/* Mode indicator */}
                    {mode === 'connect' && (
                        <div className="bg-yellow-900/50 border-b border-yellow-600 px-4 py-2 text-center text-yellow-300 text-sm dsa-text no-print">
                            {selectedNode !== null 
                                ? `‚úã Ora tocca un altro nodo per collegarlo!`
                                : `üëÜ Tocca il primo nodo da collegare`
                            }
                        </div>
                    )}

                    {/* Map Area */}
                    <div 
                        ref={mapRef}
                        className="flex-1 relative bg-slate-950 overflow-hidden"
                        style={{ minHeight: '300px' }}
                    >
                        {/* Lines SVG */}
                        <svg className="absolute inset-0 w-full h-full pointer-events-none z-0">
                            {/* AI Lines */}
                            {lines.map((line) => {
                                const coords = getLineCoords(line);
                                if (!coords) return null;
                                return (
                                    <line 
                                        key={line.id}
                                        x1={coords.x1} y1={coords.y1}
                                        x2={coords.x2} y2={coords.y2}
                                        stroke="#4ade80"
                                        strokeWidth="3"
                                        strokeOpacity="0.6"
                                    />
                                );
                            })}
                            
                            {/* User Lines */}
                            {userLines.map((line) => {
                                const coords = getLineCoords(line);
                                if (!coords) return null;
                                return (
                                    <g key={line.id}>
                                        <line 
                                            x1={coords.x1} y1={coords.y1}
                                            x2={coords.x2} y2={coords.y2}
                                            stroke="#fbbf24"
                                            strokeWidth="4"
                                            strokeDasharray="8,4"
                                        />
                                        {/* Delete button on line */}
                                        <circle
                                            cx={(coords.x1 + coords.x2) / 2}
                                            cy={(coords.y1 + coords.y2) / 2}
                                            r="12"
                                            fill="#ef4444"
                                            className="cursor-pointer pointer-events-auto"
                                            onClick={() => deleteUserLine(line.id)}
                                        />
                                        <text
                                            x={(coords.x1 + coords.x2) / 2}
                                            y={(coords.y1 + coords.y2) / 2 + 4}
                                            textAnchor="middle"
                                            fill="white"
                                            fontSize="14"
                                            fontWeight="bold"
                                            className="pointer-events-none"
                                        >
                                            √ó
                                        </text>
                                    </g>
                                );
                            })}
                        </svg>

                        {/* Nodes */}
                        {nodes.map(node => {
                            const cat = NODE_CATEGORIES[node.category] || NODE_CATEGORIES.concept;
                            const isSelected = selectedNode === node.id;
                            const isExpanded = expandedNode === node.id;
                            
                            return (
                                <div
                                    key={node.id}
                                    onClick={() => handleNodeClick(node)}
                                    className={`absolute flex flex-col items-center justify-center p-3 text-white rounded-2xl cursor-pointer transition-all z-10 dsa-text
                                        ${cat.color}
                                        ${isSelected ? 'node-selected ring-4 ring-yellow-400' : ''}
                                        ${node.isCentral ? 'text-lg font-bold' : 'text-sm font-medium'}
                                        hover:scale-105 hover:z-20
                                    `}
                                    style={{ 
                                        left: node.x, 
                                        top: node.y, 
                                        width: node.w, 
                                        height: node.h 
                                    }}
                                >
                                    <div className="text-2xl mb-1">{cat.emoji}</div>
                                    <div className="text-center leading-tight">{node.label}</div>
                                    
                                    {/* Expanded explanation */}
                                    {isExpanded && node.explanation && (
                                        <div 
                                            className="absolute top-full left-1/2 -translate-x-1/2 mt-2 bg-slate-800 border-2 border-white rounded-xl p-3 text-sm text-white shadow-2xl z-50 w-64 animate-fade-in"
                                            onClick={(e) => e.stopPropagation()}
                                        >
                                            <div className="font-bold text-yellow-400 mb-1">{cat.emoji} {node.label}</div>
                                            <div className="dsa-text">{node.explanation}</div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>

                    {/* Summary Panel */}
                    <div className="bg-slate-800 border-t-2 border-green-500 p-4 shrink-0 max-h-48 overflow-y-auto no-print">
                        <div className="flex items-center gap-3 mb-3">
                            <span className="text-2xl">üìù</span>
                            <span className="text-green-400 font-bold text-lg dsa-text">PUNTI CHIAVE</span>
                        </div>
                        
                        {mapData?.summary_points ? (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                                {mapData.summary_points.map((point, i) => (
                                    <div 
                                        key={i}
                                        className="bg-slate-700/50 rounded-lg px-3 py-2 text-slate-200 dsa-text text-sm flex items-start gap-2"
                                    >
                                        <span className="text-lg">{point.match(/^[^\w]/)?.[0] || '‚Ä¢'}</span>
                                        <span>{point.replace(/^[^\w]+/, '')}</span>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <p className="text-slate-400 dsa-text">Tocca i nodi per scoprire i concetti!</p>
                        )}
                    </div>

                    {/* Legend */}
                    <div className="flex gap-4 justify-center p-2 bg-slate-900 text-xs text-slate-400 flex-wrap no-print">
                        {Object.entries(NODE_CATEGORIES).filter(([k]) => k !== 'central').map(([key, val]) => (
                            <div key={key} className="flex items-center gap-1">
                                <span>{val.emoji}</span>
                                <span>{val.label}</span>
                            </div>
                        ))}
                        <div className="flex items-center gap-1 text-yellow-400">
                            <span>- - -</span>
                            <span>I tuoi collegamenti</span>
                        </div>
                    </div>
                </div>
            );
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // COMPONENTE: IMPOSTAZIONI
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const SettingsScreen = ({ onClose }) => {
            const [key, setKey] = useState(DB.getKey());
            const [saved, setSaved] = useState(false);

            const saveKey = () => {
                DB.setKey(key);
                setSaved(true);
                setTimeout(() => {
                    setSaved(false);
                    onClose();
                }, 1000);
            };

            return (
                <div className="h-full w-full flex flex-col items-center justify-center p-4 bg-slate-900/95 absolute inset-0 z-50">
                    <div className="bg-slate-800 p-8 rounded-2xl border border-slate-600 max-w-md w-full text-center shadow-2xl animate-fade-in">
                        <h2 className="text-2xl font-bold mb-2 text-purple-400">‚öôÔ∏è IMPOSTAZIONI</h2>
                        <p className="text-slate-400 text-sm mb-6">Inserisci la chiave API di Google AI Studio</p>

                        <input
                            type="password"
                            value={key}
                            onChange={(e) => setKey(e.target.value)}
                            placeholder="Incolla qui la API Key..."
                            className="w-full bg-slate-900 border border-slate-600 p-4 rounded-xl mb-4 text-white placeholder-slate-500 outline-none focus:border-purple-500 transition-all"
                        />

                        <button
                            onClick={saveKey}
                            className={`w-full p-4 rounded-xl font-bold text-white transition-all ${
                                saved ? 'bg-green-600' : 'bg-purple-600 hover:bg-purple-500'
                            }`}
                        >
                            {saved ? '‚úì SALVATO!' : 'SALVA'}
                        </button>

                        <button onClick={onClose} className="mt-4 text-slate-400 text-sm underline">
                            Chiudi
                        </button>

                        <div className="mt-6 p-4 bg-slate-900 rounded-xl text-left">
                            <p className="text-xs text-slate-500">
                                üìå Ottieni la chiave gratis:<br />
                                <a href="https://aistudio.google.com/apikey" target="_blank" className="text-purple-400 underline">
                                    aistudio.google.com/apikey
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // APP PRINCIPALE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const App = () => {
            const [showSettings, setShowSettings] = useState(false);
            const [xp, setXP] = useState(DB.getXP());
            const [level, setLevel] = useState(DB.getLevel());

            useEffect(() => {
                const handleXPChange = () => {
                    setXP(DB.getXP());
                    setLevel(DB.getLevel());
                };
                window.addEventListener('xpChanged', handleXPChange);
                return () => window.removeEventListener('xpChanged', handleXPChange);
            }, []);

            return (
                <div className="h-full flex flex-col overflow-hidden">
                    {/* Header */}
                    <header className="h-14 px-4 border-b border-slate-700 flex justify-between items-center bg-slate-950 shrink-0 z-50 no-print">
                        <div className="flex items-center gap-4">
                            <div className="text-xl font-bold tracking-tighter flex items-center gap-2 text-green-400">
                                <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                EDUGAMER
                            </div>

                            <div className="hidden md:flex flex-col w-32">
                                <div className="flex justify-between text-xs text-yellow-400 font-bold mb-1">
                                    <span>LVL {level}</span>
                                    <span>{xp} XP</span>
                                </div>
                                <div className="h-2 bg-slate-800 rounded-full overflow-hidden border border-slate-600">
                                    <div
                                        className="h-full xp-bar-fill transition-all duration-500"
                                        style={{ width: `${Math.min(100, (xp % 100))}%` }}
                                    ></div>
                                </div>
                            </div>
                        </div>

                        <button
                            onClick={() => setShowSettings(!showSettings)}
                            className="p-2 rounded-lg border border-slate-600 hover:bg-slate-800 transition-all"
                        >
                            <Icons.Settings className="w-5 h-5" />
                        </button>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 overflow-hidden relative bg-slate-900">
                        {showSettings ? (
                            <SettingsScreen onClose={() => setShowSettings(false)} />
                        ) : (
                            <CyberBoard />
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
